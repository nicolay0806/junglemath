<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŸ³å™¨æ•¸å­¸å¤§å†’éšª</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Carter+One&family=cwTeXYen&display=swap" rel="stylesheet">
    <style>
        :root {
            --stone-grey: #cfd8dc;
            --stone-dark: #78909c;
            --dino-orange: #ffab40; /* åŠé½’è™æ©˜ */
            --jungle-green: #66bb6a;
            --bone-white: #fff9c4;
            --sky-blue: #4fc3f7;
            --text-color: #37474f;
        }

        body {
            font-family: 'Carter One', 'cwTeXYen', cursive, sans-serif;
            background-color: #8d6e63;
            /* èƒŒæ™¯ï¼šæ¨¡ä»¿ç¸çš®æ–‘é»æˆ–åŸå§‹å¢æ— */
            background-image: 
                radial-gradient(circle at 10% 20%, #6d4c41 5%, transparent 6%),
                radial-gradient(circle at 90% 80%, #5d4037 8%, transparent 9%),
                linear-gradient(135deg, #a1887f 0%, #8d6e63 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        /* ä¸»å®¹å™¨ï¼šä¸€å¡Šå·¨å¤§çš„ä¸è¦å‰‡çŸ³é ­ */
        .stone-slab {
            background: var(--stone-grey);
            /* å¡é€šçŸ³é ­è³ªæ„Ÿï¼šå™ªé» */
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%2390a4ae' fill-opacity='0.4' fill-rule='evenodd'/%3E%3C/svg%3E");
            padding: 2.5rem;
            width: 90%;
            max-width: 450px;
            text-align: center;
            position: relative;
            color: var(--text-color);
            /* é—œéµï¼šä¸è¦å‰‡çš„é‚Šæ¡†åŠå¾‘ï¼Œçœ‹èµ·ä¾†åƒçŸ³é ­ */
            border-radius: 2% 98% 1% 99% / 98% 2% 99% 1%; 
            border: 8px solid var(--text-color);
            box-shadow: 15px 15px 0px rgba(0,0,0,0.2); /* ç¡¬é™°å½±ï¼Œå¡é€šæ„Ÿ */
        }
        
        /* è®“çŸ³é ­é‚Šè§’æ›´è‡ªç„¶ä¸€é» */
        .stone-slab {
            border-radius: 25px 225px 15px 255px / 225px 15px 255px 15px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .stats-box {
            background: var(--bone-white);
            padding: 10px 20px;
            border: 4px solid var(--text-color);
            border-radius: 50px 10px 50px 10px;
            font-size: 1.1rem;
            transform: rotate(-2deg);
        }

        /* èƒŒåŒ…æŒ‰éˆ•ï¼šåšæˆä¸€å€‹ç¶èµ·ä¾†çš„çš®è¢‹å­ */
        .bag-btn {
            background: var(--dino-orange);
            color: var(--text-color);
            border: 4px solid var(--text-color);
            padding: 10px 15px;
            border-radius: 40% 40% 20% 20%;
            cursor: pointer;
            font-weight: bold;
            font-family: inherit;
            box-shadow: 4px 4px 0 var(--text-color);
            transition: transform 0.1s;
        }
        .bag-btn:active { transform: translateY(4px); box-shadow: 0 0 0; }

        .question-area {
            margin: 2rem 0;
            padding: 1.5rem;
            /* åˆ»åœ¨çŸ³æ¿ä¸Šçš„æ„Ÿè¦º */
            background: rgba(0,0,0,0.05);
            border-radius: 15px;
            border: 4px dashed var(--text-color);
        }

        .question {
            font-size: 3.8rem;
            margin: 0;
            color: var(--text-color);
        }

        .btn-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        /* ç­”æ¡ˆæŒ‰éˆ•ï¼šæé¾è›‹æˆ–éµåµçŸ³ */
        .rock-btn {
            background: white;
            padding: 1.5rem;
            font-size: 1.8rem;
            border: 4px solid var(--text-color);
            /* ä¸è¦å‰‡åœ“å½¢ */
            border-radius: 60% 40% 70% 30% / 50% 60% 30% 60%;
            color: var(--text-color);
            cursor: pointer;
            font-family: inherit;
            box-shadow: 0 8px 0 #b0bec5; /* åšå¯¦çš„çŸ³é ­é™°å½± */
            transition: all 0.1s;
        }

        .rock-btn:active {
            transform: translateY(6px);
            box-shadow: 0 2px 0 #b0bec5;
        }

        .rock-btn.correct { background: var(--jungle-green); border-color: #1b5e20; color: white; box-shadow: 0 8px 0 #1b5e20; }
        .rock-btn.wrong { background: #ff5252; border-color: #b71c1c; color: white; box-shadow: 0 8px 0 #b71c1c; }
        .rock-btn.hidden { visibility: hidden; }

        /* æ¨¡æ…‹è¦–çª—ï¼šæ•´å¼µç¸çš®è“‹ä¸‹ä¾† */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 999;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: var(--dino-orange);
            /* ç¸çš®æ–‘é» */
            background-image: radial-gradient(var(--text-color) 15%, transparent 16%), radial-gradient(var(--text-color) 15%, transparent 16%);
            background-size: 60px 60px;
            background-position: 0 0, 30px 30px;
            padding: 5px; /* é‚Šæ¡† */
            border-radius: 20px;
            transform: rotate(2deg);
            width: 90%;
            max-width: 400px;
        }

        .modal-inner {
            background: var(--bone-white);
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            border: 5px solid var(--text-color);
        }

        .item-list {
            max-height: 50vh;
            overflow-y: auto;
            text-align: left;
            margin: 15px 0;
        }

        .item-row {
            border-bottom: 2px dashed var(--text-color);
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .action-btn {
            background: var(--sky-blue);
            border: 3px solid var(--text-color);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 3px 3px 0 var(--text-color);
            font-family: inherit;
        }
        .action-btn:active { transform: translate(3px, 3px); box-shadow: 0 0 0; }

        /* ç­‰ç´šé¡è‰² */
        .rank-ssr { color: #f50057; font-weight: 900; }
        .rank-sr { color: #6200ea; font-weight: bold; }
        .rank-s { color: var(--text-color); }

    </style>
</head>
<body>

<div class="stone-slab">
    <div class="header">
        <div class="stats-box">
            <div>ğŸ– ç©åˆ†ï¼š<span id="score">0</span></div>
            <div>ğŸ”¥ é€£å‹ï¼š<span id="combo">0</span>/10</div>
        </div>
        <button class="bag-btn" onclick="openBag()">ğŸ’ è—å¯¶è¢‹ (<span id="bag-count">0</span>)</button>
    </div>

    <div class="question-area">
        <p id="q-text" class="question">...</p>
    </div>

    <div class="btn-grid" id="options">
        <button class="rock-btn" onclick="check(this)">?</button>
        <button class="rock-btn" onclick="check(this)">?</button>
        <button class="rock-btn" onclick="check(this)">?</button>
        <button class="rock-btn" onclick="check(this)">?</button>
    </div>
</div>

<div id="win-modal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-inner">
            <h2 id="win-title" style="font-size: 2.5rem; margin:0;">å“‡å—šï¼</h2>
            <p style="font-size: 1.2rem;">æ‰¾åˆ°äº†å‚³èªªä¸­çš„...</p>
            <div id="win-item" style="font-size: 2rem; font-weight:bold; margin: 20px 0; color: var(--dino-orange); -webkit-text-stroke: 2px var(--text-color);">å¯¶ç‰©</div>
            <p id="win-desc" style="color: #666; font-size: 0.9rem;"></p>
            <button class="action-btn" style="width: 100%; background: var(--jungle-green); color: white;" onclick="closeWinAndNext()">æ”¾å…¥è¢‹å­ï¼Œç¹¼çºŒå†’éšªï¼</button>
        </div>
    </div>
</div>

<div id="bag-modal" class="modal-overlay">
    <div class="modal-content" style="transform: rotate(-1deg);">
        <div class="modal-inner">
            <h2>ğŸ’ æˆ‘çš„æ”¶è—</h2>
            <div id="bag-list" class="item-list"></div>
            <button class="action-btn" style="width: 100%;" onclick="closeBag()">é—œé–‰</button>
        </div>
    </div>
</div>

<script>
    // éŠæˆ²æ•¸æ“š
    let score = 0;
    let combo = 0;
    let ans = 0;
    let bag = JSON.parse(localStorage.getItem('DinoMath_Bag_V1')) || [];

    // å¯¶ç‰©è³‡æ–™åº«
    const DB = {
        SSR: [
            {n: "éœ¸ç‹é¾ç‰™é½’", d: "éœ¸æ°£å¤–éœ²ï¼ç›´æ¥åš‡è·‘æ‰€æœ‰éŒ¯èª¤ç­”æ¡ˆ (è‡ªå‹•éé—œ)"},
            {n: "å¤–æ˜ŸäººçŸ³æ¿", d: "æ“æœ‰é«˜ç­‰æ™ºæ…§ï¼è‡ªå‹•é¸å‡ºæ­£ç¢ºç­”æ¡ˆ"},
            {n: "é»ƒé‡‘ä¸‰è§’é¾", d: "ç„¡å …ä¸æ‘§ï¼è¡æ’æ‰€æœ‰éšœç¤™ (è‡ªå‹•éé—œ)"}
        ],
        SR: [
            {n: "åŠé½’è™æ¯›çš®", d: "æº«æš–çš„åŠ›é‡ï¼Œç§»é™¤ 2 å€‹éŒ¯èª¤é¸é …"},
            {n: "ç¥ç¥•ç™¼å…‰çŸ³", d: "ç…§äº®çœŸç›¸ï¼Œç§»é™¤ 2 å€‹éŒ¯èª¤é¸é …"},
            {n: "å§‹ç¥–é³¥ç¾½æ¯›", d: "è¼•ç›ˆé£›ç¿”ï¼Œç§»é™¤ 2 å€‹éŒ¯èª¤é¸é …"},
            {n: "å·«å¸«çš„éª¨æ£’", d: "æ–½å±•æ³•è¡“ï¼Œç§»é™¤ 2 å€‹éŒ¯èª¤é¸é …"}
        ],
        S: [
            {n: "ç ´æçš„çŸ³æ–§", d: "é‚„ç®—é †æ‰‹ï¼Œç§»é™¤ 1 å€‹éŒ¯èª¤é¸é …"},
            {n: "çŒ›ç‘ªè±¡ä¾¿ä¾¿", d: "è‡­æ­»äººäº†ï¼ç†èµ° 1 å€‹éŒ¯èª¤é¸é …"},
            {n: "å¥‡æ€ªçš„æœå¯¦", d: "åƒäº†è®Šè°æ˜ï¼Ÿç§»é™¤ 1 å€‹éŒ¯èª¤é¸é …"},
            {n: "ä¹¾æ‰çš„èœ¥èœ´", d: "ä¸çŸ¥é“èƒ½å¹¹å˜›ï¼Œç§»é™¤ 1 å€‹éŒ¯èª¤é¸é …"},
            {n: "åœ“æ»¾æ»¾çŸ³é ­", d: "å–®ç´”çš„çŸ³é ­ï¼Œç§»é™¤ 1 å€‹éŒ¯èª¤é¸é …"}
        ]
    };

    function init() {
        updateUI();
        nextQ();
    }

    // å‡ºé¡Œé‚è¼¯
    function nextQ() {
        const mode = Math.random();
        let a, b;
        
        // 40% ç™¾ä½åŠ æ³•, 30% ç™¾ä½æ¸›æ³•, 30% ç™¾åŠ åƒ
        if (mode < 0.4) {
            a = rand(100, 800); b = rand(100, 800);
            ans = a + b;
            document.getElementById('q-text').innerText = `${a} + ${b}`;
        } else if (mode < 0.7) {
            a = rand(200, 900); b = rand(50, a - 100);
            ans = a - b;
            document.getElementById('q-text').innerText = `${a} - ${b}`;
        } else {
            a = rand(100, 900); b = rand(1000, 4000);
            ans = a + b;
            document.getElementById('q-text').innerText = `${a} + ${b}`;
        }

        // ç”¢ç”Ÿé¸é …
        let opts = [ans];
        while (opts.length < 4) {
            let fake = ans + (rand(1, 15) * (Math.random() > 0.5 ? 10 : 1));
            if (fake > 0 && fake !== ans && !opts.includes(fake)) opts.push(fake);
        }
        opts.sort(() => Math.random() - 0.5);

        // æ¸²æŸ“æŒ‰éˆ•
        const btns = document.querySelectorAll('.rock-btn');
        btns.forEach((btn, i) => {
            btn.innerText = opts[i];
            btn.className = 'rock-btn'; // é‡ç½®æ¨£å¼
            btn.disabled = false;
        });
    }

    function check(btn) {
        const val = parseInt(btn.innerText);
        const all = document.querySelectorAll('.rock-btn');
        all.forEach(b => b.disabled = true); // é–å®š

        if (val === ans) {
            btn.classList.add('correct');
            score += 100;
            combo++;
            
            if (combo >= 10) {
                setTimeout(openWin, 800); // è§¸ç™¼å¯¶ç‰©
            } else {
                setTimeout(() => {
                    updateUI();
                    nextQ();
                }, 800);
            }
        } else {
            btn.classList.add('wrong');
            combo = 0;
            updateUI();
            setTimeout(() => {
                nextQ();
            }, 1500);
        }
        updateUI();
    }

    // å¯¶ç‰©ç³»çµ±é‚è¼¯
    function openWin() {
        // æŠ½ç
        let r = Math.random();
        let tier = "S";
        if (r < 0.05) tier = "SSR";
        else if (r < 0.25) tier = "SR";

        const pool = DB[tier];
        const item = pool[Math.floor(Math.random() * pool.length)];

        // é¡¯ç¤ºä»‹é¢
        document.getElementById('win-title').innerText = tier + " ç´šå¯¶ç‰©ï¼";
        document.getElementById('win-title').className = tier === "SSR" ? "rank-ssr" : (tier === "SR" ? "rank-sr" : "rank-s");
        document.getElementById('win-item').innerText = item.n;
        document.getElementById('win-desc').innerText = item.d;

        // å­˜å…¥èƒŒåŒ…
        bag.push({ ...item, tier });
        localStorage.setItem('DinoMath_Bag_V1', JSON.stringify(bag));
        updateUI();

        document.getElementById('win-modal').style.display = 'flex';
    }

    // é—œéµä¿®å¾©ï¼šé€™è£¡ç¢ºä¿æŒ‰éˆ•æŒ‰ä¸‹å¾Œï¼Œå¿…å®šé—œé–‰è¦–çª—ä¸¦é‡æ–°å‡ºé¡Œ
    function closeWinAndNext() {
        document.getElementById('win-modal').style.display = 'none';
        combo = 0; // é‡ç½®é€£å‹
        updateUI();
        nextQ(); // ç”¢ç”Ÿä¸‹ä¸€é¡Œ
    }

    // èƒŒåŒ…èˆ‡é“å…·é‚è¼¯
    function openBag() {
        const list = document.getElementById('bag-list');
        list.innerHTML = bag.length ? "" : "èƒŒåŒ…è£¡åªæœ‰ç©ºæ°£...";
        
        bag.forEach((item, idx) => {
            const div = document.createElement('div');
            div.className = 'item-row';
            div.innerHTML = `
                <div>
                    <span class="${item.tier === 'SSR' ? 'rank-ssr' : (item.tier === 'SR' ? 'rank-sr' : '')}">[${item.tier}]</span>
                    <b>${item.n}</b>
                </div>
                <button class="action-btn" style="font-size:0.8rem; padding:5px 10px;" onclick="useItem(${idx})">ç”¨æ‰</button>
            `;
            list.appendChild(div);
        });
        document.getElementById('bag-modal').style.display = 'flex';
    }

    function useItem(idx) {
        const item = bag[idx];
        const btns = Array.from(document.querySelectorAll('.rock-btn'));
        const wrongs = btns.filter(b => parseInt(b.innerText) !== ans);

        // é“å…·æ•ˆæœ
        if (item.tier === "SSR") {
            // ç›´æ¥å¹«å¿™é»æ“Šæ­£ç¢ºç­”æ¡ˆ
            closeBag();
            btns.find(b => parseInt(b.innerText) === ans).click();
        } else {
            // åˆªé™¤é¸é …
            let count = item.tier === "SR" ? 2 : 1;
            wrongs.sort(() => Math.random() - 0.5).slice(0, count).forEach(b => {
                b.classList.add('hidden');
                b.disabled = true;
            });
            closeBag();
        }

        // æ¶ˆè€—é“å…·
        bag.splice(idx, 1);
        localStorage.setItem('DinoMath_Bag_V1', JSON.stringify(bag));
        updateUI();
    }

    function closeBag() {
        document.getElementById('bag-modal').style.display = 'none';
    }

    function updateUI() {
        document.getElementById('score').innerText = score;
        document.getElementById('combo').innerText = combo;
        document.getElementById('bag-count').innerText = bag.length;
    }

    function rand(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    init();
</script>

</body>
</html>
